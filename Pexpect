import pexpect

command = 'xcodes download 14.3'
child = pexpect.spawn('/bin/bash', ['-c', command])

# Wait for one of the possible prompts
prompts = ['Apple ID:', 'Apple ID Password:', 'Enter "sms" without quotes to exit this prompt and choose a phone number to send an SMS security code to.\nEnter the 6 digit code from one of your trusted devices']

try:
    while True:
        index = child.expect(prompts + [pexpect.EOF, pexpect.TIMEOUT])

        if index < len(prompts):
            # Print child output up to the prompt
            print("Output before prompt:", child.before.decode())

            user_input = input(prompts[index])
            child.sendline(user_input)
        else:
            # The child process has finished or timeout occurred
            break
except pexpect.exceptions.EOF:
    print("End of File. Probably the child process has finished")
except pexpect.exceptions.TIMEOUT:
    print("Timeout")
except Exception as e:
    print("Unexpected error: ", e)

print("Child process has finished")
