let url = URL(string: "https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh")!
let task = URLSession.shared.dataTask(with: url) { (data, response, error) in
    guard let data = data, error == nil else {
        print("Failed to fetch Homebrew installation script: \(String(describing: error))")
        exit(1)
    }
    
    let script = String(data: data, encoding: .utf8)!
    let tmpScriptURL = URL(fileURLWithPath: NSTemporaryDirectory()).appendingPathComponent("install_homebrew.sh")
    
    do {
        try script.write(to: tmpScriptURL, atomically: true, encoding: .utf8)
        print("Temporary Homebrew installation script created at \(tmpScriptURL.path)")
        
        let process = Process()
        process.executableURL = URL(fileURLWithPath: "/bin/bash")
        process.arguments = [tmpScriptURL.path]
        
        try process.run()
        process.waitUntilExit()
        
        try FileManager.default.removeItem(at: tmpScriptURL)
        print("Homebrew installation script removed")
    } catch {
        print("Failed to run Homebrew installation script: \(error)")
        exit(1)
    }
}

task.resume()
